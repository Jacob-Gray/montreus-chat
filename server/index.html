<!DOCTYPE html>
<html>
    <head>
        <title>Montreus Chat</title>
        <link rel="stylesheet" type="text/css" href="reset.css"> 
       <link href="http://cdn.foundation5.zurb.com/foundation.css" rel="stylesheet" type="text/css"> 
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font: 16px "Helvetica Neue", Helvetica, Arial;
                max-height: 100%;
                overflow:hidden;
            }
            form {
                background: #dbdbdb;
             
                position: fixed;
                bottom: 0;
                width: 80%;
                display: inline;
                margin:0px;
            }
            button{
                margin-bottom: 1em;
             
                width: 100%;

            }
            .button{
                margin-bottom: 0%;
            }
            form input {
                border: 0;
                padding: 10px;
                width: 90.5%;
                margin-right: .5%;
            }
            form button {
                width: 9%;
                background: #1e89cf;
                border: none;
                padding: 10px;
                color: white;
            }
            #messages {
                list-style-type: none;
                margin-left: 0;
                margin-top: 0;
                margin-bottom: 0;
                margin-right: 20%;
                padding: 0;
            }
            #messages li {
                padding: 5px 10px;
                font-size: 1.4em;
            }
            #messages li:nth-child(odd) {
                background: #eee;
            }
            body {
                /*padding-bottom: 70px;*/
            }
            #sidebar {
                background-color: #dbdbdb;
                float: right;
                width: 20%;
              
               
            }
            h1, h2, h3, h4, h5, h6{
                margin-bottom: 0px;
            }
            a:link {
                color: #1e89cf;
            }
            a:visited {
                color: #1e89cf;
            }
            .alignLeft {
                float:left;
            }
            .alignRight {
                float:right;
            }
            input[type="text"], input[type="password"], input[type="date"], input[type="datetime"], input[type="datetime-local"], input[type="month"], input[type="week"], input[type="email"], input[type="number"], input[type="search"], input[type="tel"], input[type="time"], input[type="url"], input[type="color"], textarea{
                margin-bottom: 0px;

            }

            form  div.row{
                width: 100%;
                margin-left: 0%;
                margin-right: 0%;
                max-width: inherit;
            }
            #sidebar{
                padding-right: 1%;
                padding-left: 1%;
                height: 100%;
            }
            header{
                padding: 0.5em 2% 0.5em 2%;
                background-color: #0d0d0d;
                color: #f6f6f6;
                margin-top:0px;
            }
            header h1{
                 color: #f6f6f6;
                 margin-top:0px;
            }
            h1{margin-top:0px;}
            </style>
    </head>
    <body>
        <header>
            <h1>Montreus-Chat</h1>
        </header>
        <div id="main">
        <ul id="messages"></ul>
        <form action="">
         
       <!--  <input id="messageInput" autocomplete="off" /><button>Send</button>  -->
       
    <div class="large-12">
      <div class="row collapse">
             <div class="small-10 columns">
                <input autocomplete="off" id="messageInput" type="text" placeholder="Your message">

            </div>
            <div class="small-2 columns">
                <a href="#" class="button postfix">Go</a>
          
        </div>
    </div>
</div>
        </form>
        </div>
        <div id="sidebar">
            <h1 style="width:100%; text-align: center; color: white; font-size: 22px; font-weight: 300; position: relative;">Montreus Chat (v.1.3.3)</p><br>
            <p class="username" style="position: relative; width:100%; text-align: center; color: white; font-size: 16px"></p>
            <div style="width: 100%; text-align: center; position: relative; font-size:14px;">
            <button name="button" onClick="changeUsername()">Change Username</button><br>
            <button name="button" style="top: 11%;" onClick="changeRoom()">Change Room</button>
            </div>
            <br>
            <p class="connectionLabel" style="position: relative; width:100%; text-align: center; color: white; font-size: 16px"></p><br>
            <p style="position: relative; width:100%; text-align: center; color: white; font-size: 14px"><a href="http://github.com/gtomitsuka/montreus-chat" target="_blank">GitHub Source</a></p>
            <p style="position: relative; width:100%; text-align: center; margin-bottom: 10px; color: white;font-size:14px;">&#0169;2015 by Montreus S-AG.</p>
        </div>
        <div style="clear: both;"></div>
        <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
        <script src="http://cdn.foundation5.zurb.com/foundation.js"></script>
        <script>
            var currentUser;
                    $(document).ready(function(){
                        var username = localStorage.getItem('MTChat_Username');
                        if(username === null){
                            var returnedUsername = prompt("Welcome to Montreus Chat!\n Please type in an username. (Leave empty for no username at all)");
                                    if(returnedUsername !== null){
                                        localStorage.setItem('MTChat_Username', returnedUsername);
                                        currentUser = returnedUsername;
                                    }
                        }else{
                            currentUser = username;
                        }
                            $(".username").html("Welcome, " + currentUser);
                            var connectionQuery = "username=" + currentUser;
                            var socket = io.connect("" , {query:connectionQuery});
                            $('form').submit(function(e){
                                e.preventDefault(); //For avoiding that the page auto refreshes
                                var messageInput = $('#messageInput').val();
                                if(!verifyEmptyness(messageInput)){
                                    var messageToSend = {
                                             message: messageInput,
                                             username: currentUser,
                                            date: Date.now()
                                                };
                                    socket.emit('chat message', messageToSend);
                                    $('#messageInput').val('');
                                    return false;
                                }
                            });
                            socket.on('chat message', function(msg){
                                $('#messages').append('<li style="display: table; width: 100%;">' + msg + "</li>");
                            });
                            socket.on('connections', function(userList){
                                      if(userList === 1){
                                $(".connectionLabel").html("There is currently 1 user online");
                                      }else if(isNumber(userList) === true){
                                $(".connectionLabel").html("There are currently " + userList + " users online");
                                      }else{
                                $(".connectionLabel").html(userList);
                                      }
                            });
                        });
                        function changeUsername(){
                            var oldUsername = currentUser;
                            var returnedUsername = prompt("Your current username is " + currentUser + ".\nType in a new username:");
                            if(!verifyEmptyness(returnedUsername) && returnedUsername !== null){
                                localStorage.setItem('MTChat_Username', returnedUsername);
                                currentUser = returnedUsername;
                                $(".username").html("Welcome, " + currentUser);
                                socket.emit('postName', currentUser);
                                }
                        }
                            //Thanks to Jano GonzÃ¡lez from SE for this
                var verifyEmptyness = function(str) {
                        return (str.length === 0 || !str.trim());
                };
                var isNumber = function(obj) {
                    return (!jQuery.isArray(obj) && (obj - parseFloat(obj) + 1) >= 0);
                }
            </script>
    </body>
</html>
